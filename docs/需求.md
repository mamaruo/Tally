# Tally 记账 App — 需求文档

更新时间：2025-12-17

## 1. 项目目标

构建一款离线优先的个人记账应用，支持记录收入/支出、按月汇总、按日分组浏览，并提供“分类（名称 + 图标）”的管理能力。

## 2. 技术栈与约束

### 2.1 技术栈选择

- 语言：Kotlin（Kotlin Android 插件 + Compose 插件）
- UI：Jetpack Compose
- 主题：直接使用 Material Design 3 默认主题 `androidx.compose.material3.MaterialTheme`
- 图标：仅使用 `androidx.compose.material.icons.Icons`（material-icons-core / material-icons-extended）
- 导航：Navigation Compose
- 本地存储：Room（runtime + ktx），使用 KSP 生成代码
- 依赖注入：Hilt（Android + Compiler），使用 KSP
- 最低/目标版本：minSdk 28，targetSdk 36，compileSdk 36
- 其他：AndroidX Core KTX、Lifecycle Runtime KTX、Activity Compose

### 2.2 关键限制与设计原则

- 离线优先：所有核心功能在无网络环境可用；不包含云同步/登录/多设备同步需求。
- 单一账户：无“账本”概念；所有交易记录均属于同一个账户（即全局唯一集合）。
- 日期粒度：交易只记录“日期（年-月-日）”，不记录具体时间；列表按日分组展示。
- 金额精度：金额需避免浮点误差；以“最小货币单位”整型存储（分：Long）。显示时除以 100 并格式化。
- 视觉与交互：遵循 Material3 组件与默认主题能力，不引入其他 UI 框架/主题系统。
- 图标管理：仅使用 `androidx.compose.material.icons.Icons` 提供的图标，通过 `String` 类型的 `iconKey` 映射到具体 `ImageVector`，不存储图片二进制数据。

## 3. 核心概念与术语

- 交易（Transaction）：一笔收入或支出记录。
- 分类（Category）：用于区分交易用途/来源的标签，包含名称、图标，且与交易类型（收入/支出）绑定。每个分类只能属于一种类型（如“工资”只能是收入，“餐饮”只能是支出）。
- 当月花销：当月所有“支出”金额求和。
- 当月结余：当月“收入总额 - 支出总额”。

## 4. 功能需求（FR）

### FR-01 主页（当月概览 + 当月交易列表）

#### 目标
用户打开 App 即可看到当月概览，并能快速浏览当月交易明细。

#### 展示内容
- 顶部概览区：
	- 当月花销（支出合计）
	- 当月结余（收入合计 - 支出合计）
- 下方列表区：
	- 以列表形式展示“当月所有交易”
	- 按“日”分组（例如：12/17、12/16…）
	- 组内按交易日期排序；同一天内的排序规则可先采用“创建顺序倒序”。

#### 交互
- 点击某条交易：进入“编辑交易”页面。
- 主页提供新增入口：进入“新增交易”页面。

### FR-02 新增交易

#### 输入项
- 类型：支出 / 收入（二选一）
- 金额：必填，正数（2位小数）
- 日期：必填，仅日期（不含时间）
- 分类：必填，从与所选类型匹配的分类列表中选择（如选择“收入”则只显示收入分类）
- 备注：可选，文本

#### 行为
- 保存：写入本地数据库；返回主页；主页当月概览与列表应即时更新。
- 取消/返回：不保存变更。

### FR-03 编辑交易

#### 行为
- 支持修改：类型、金额、日期、分类、备注。分类选择会根据当前选择的交易类型自动过滤（只显示匹配类型的分类）。
- 支持删除交易：删除后返回主页；主页统计与列表即时更新。

### FR-04 分类管理

#### 分类字段
- 名称：必填，用户可见文本
- 类型：必填，INCOME（收入）或 EXPENSE（支出），每个分类只能属于一种类型
- 图标：必填，从 `Icons` 提供的图标集合中选择，具体可选图标见 [8.2 图标子集](#82-图标子集)

#### 默认分类
- App 首次启动需内置一组常见分类，在 `RoomDatabase` 创建时的回调 (`onCreate`) 中预填充，具体映射见 [8.3 默认分类初始化](#83-默认分类初始化)

#### 用户自定义
- 用户可新增分类（名称 + 类型 + 图标）
- 暂不实现删除分类。

### 5.1 全局 UI 规范

- 仅使用 Material3 组件与 `MaterialTheme`
	- 颜色仅使用 `MaterialTheme.colorScheme`
- 图标仅使用 `androidx.compose.material.icons.Icons`
- 文案尽量简洁，数值展示需明确单位“¥”。

### 5.2 页面清单

1) 主页（Home）
- 顶部：两块信息卡/区域（当月花销、当月结余）。
- 内容：按日分组的当月交易列表。
- 每条交易 item 展示：分类图标 + 分类名称、备注（若有）、金额（收入/支出视觉区分仅用文本符号或颜色需依赖主题默认语义色，禁止引入自定义色板）。
- 右下使用 `androidx.compose.material3.LargeFloatingActionButton` 给出添加交易的入口。

2) 新增/编辑交易（TransactionEditor）
- 顶部标题：新增交易 / 编辑交易
- 表单区域：类型切换、分类选择、金额输入、日期选择（默认选择今天）、备注输入（可选）.
- 底部操作：保存；编辑态额外提供删除

3) 分类管理（CategoryManage）
- 分类列表：显示图标、名称与类型（收入/支出）
- 新增分类入口：进入新增分类表单

4) 新增分类（CategoryEditor）
- 名称输入
- 类型选择（收入/支出）
- 图标选择（从 `Icons` 列表中选）
- 保存/取消

## 6. 数据需求（建议的数据结构约束）

### 6.1 Transaction（交易）

- id：主键
- type：INCOME / EXPENSE
- amountMinor：Long（最小货币单位，分）使用 `Long` 存储“分”。
- date：LocalDate 使用 `LocalDate`，通过 Room TypeConverter 转换为 `String` (ISO-8601: "yyyy-MM-dd") 存储，便于调试与可读性。
- categoryId：外键
- note：String?（备注，可空）

### 6.2 Category（分类）

- id：主键
- name：String 
- type：INCOME / EXPENSE
- iconKey：String（用于映射到 `Icons` 的具体图标；不存储图片二进制）
- isDefault：Boolean

## 7. 统计口径与规则

- 当月范围：以系统日期所在月份为准（本版本不提供月份切换 UI）。
- 当月花销 = 该月所有 EXPENSE 的 sum(amountMinor)
- 当月收入 = 该月所有 INCOME 的 sum(amountMinor)
- 当月结余 = 当月收入 - 当月花销

## 8. 补充技术细节（Implementation Details）

### 8.1 图标子集

为平衡选择灵活性与性能，App 仅提供以下 **30 个**精选图标供用户选择。通过 `IconRegistry` 单例维护 `String (key) -> ImageVector` 的映射：

**生活消费 (12)**
- `Restaurant` - 餐饮
- `LocalCafe` - 咖啡/饮品
- `ShoppingCart` - 购物
- `LocalGroceryStore` - 超市/杂货
- `Commute` (或 `Train`) - 交通
- `LocalGasStation` - 加油
- `Home` - 住房/家居
- `Hotel` - 住宿/酒店
- `LocalLaundryService` - 洗衣/清洁
- `MedicalServices` - 医疗/药品
- `SportsEsports` - 娱乐/游戏
- `Movie` - 电影/影音

**财务收支 (8)**
- `AttachMoney` - 现金/通用收入
- `AccountBalance` - 银行/账户
- `CreditCard` - 信用卡/支付
- `Savings` - 存款/理财
- `TrendingUp` - 投资/增长
- `TrendingDown` - 亏损/减少
- `Payments` - 账单/付款
- `ReceiptLong` - 报销/单据

**工作学习 (6)**
- `Work` - 工资/工作
- `BusinessCenter` - 商务/办公
- `School` - 教育/学习
- `MenuBook` - 书籍/资料
- `LaptopMac` (或 `Computer`) - 设备/数码
- `Build` - 维修/工具

**其他 (4)**
- `Flight` - 旅行/机票
- `Pets` - 宠物
- `CardGiftcard` - 礼品/红包
- `Celebration` - 节日/庆典

### 8.2 默认分类初始化

在 `RoomDatabase` 创建时的回调 (`onCreate`) 中预填充以下内置分类。所有内置分类的 `isDefault` 字段为 `true`：

**支出分类 (8个)**
1. 餐饮 - `Restaurant` (类型: EXPENSE)
2. 购物 - `ShoppingCart` (类型: EXPENSE)
3. 交通 - `Commute` (类型: EXPENSE)
4. 住房 - `Home` (类型: EXPENSE)
5. 娱乐 - `SportsEsports` (类型: EXPENSE)
6. 医疗 - `MedicalServices` (类型: EXPENSE)
7. 通讯 - `PhoneAndroid` (或 `SettingsPhone`) (类型: EXPENSE)
8. 人情 - `CardGiftcard` (类型: EXPENSE)

**收入分类 (4个)**
1. 工资 - `Work` (类型: INCOME)
2. 奖金 - `AttachMoney` (类型: INCOME)
3. 理财 - `TrendingUp` (类型: INCOME)
4. 兼职 - `Payments` (类型: INCOME)

### 8.4 数据持久化细节
- **日期存储**: 
